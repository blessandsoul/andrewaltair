# üìß Email Verification - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üéâ –ß–¢–û –£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢

Email verification **–£–ñ–ï –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù** –≤ –∫–æ–¥–µ:
- ‚úÖ Backend API –≥–æ—Ç–æ–≤
- ‚úÖ Email templates —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ** - emails –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ Ethereal (—Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä).

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–†–ê–ë–û–¢–ê–ï–¢ –°–ï–ô–ß–ê–°)

**–ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!** –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–∞–π—Ç–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ Coolify
3. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É: `Preview URL: https://ethereal.email/message/xxx`
4. –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É - —É–≤–∏–¥–∏—Ç–µ email —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü–ª—é—Å—ã:** –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É, –±–µ—Å–ø–ª–∞—Ç–Ω–æ  
**–ú–∏–Ω—É—Å—ã:** –†–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—Ç emails

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Gmail (–†–ï–ö–û–ú–ï–ù–î–£–Æ –î–õ–Ø –°–¢–ê–†–¢–ê)

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ App Password

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://myaccount.google.com/apppasswords
2. –í–∫–ª—é—á–∏—Ç–µ 2FA –µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞
3. –°–æ–∑–¥–∞–π—Ç–µ App Password:
   - App: **Mail**
   - Device: **Other** (–Ω–∞–ø–∏—à–∏—Ç–µ "Andrew Altair")
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ 16-–∑–Ω–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å**

#### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ –≤ Coolify

–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ Coolify ‚Üí Environment Variables ‚Üí –î–æ–±–∞–≤—å—Ç–µ:

```bash
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=–≤–∞—à-email@gmail.com
SMTP_PASS=abcd efgh ijkl mnop
SMTP_FROM="Andrew Altair <noreply@andrewaltair.ge>"
NEXT_PUBLIC_APP_URL=https://andrewaltair.ge
```

#### –®–∞–≥ 3: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ

Coolify –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å —Ä–µ–∞–ª—å–Ω—ã–µ emails –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ Gmail.

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: Resend (–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô)

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É—é Resend - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

#### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://resend.com
2. Sign Up (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ GitHub)
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email

#### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á

1. Dashboard ‚Üí **API Keys**
2. **Create API Key**
3. Name: `Andrew Altair`
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `re_...`)

#### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç

```bash
npm install resend
```

#### –®–∞–≥ 4: –î–æ–±–∞–≤—å—Ç–µ –≤ Coolify

```bash
RESEND_API_KEY=re_–≤–∞—à_–∫–ª—é—á
SMTP_FROM="Andrew Altair <noreply@andrewaltair.ge>"
NEXT_PUBLIC_APP_URL=https://andrewaltair.ge
```

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥

–í —Ñ–∞–π–ª–µ `src/app/api/auth/register/route.ts` –∑–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É 84:

**–ë—ã–ª–æ:**
```typescript
sendWelcomeEmail(fullName, email, verificationUrl).catch(err => console.error('Verification email error:', err))
```

**–°—Ç–∞–Ω–µ—Ç:**
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º Resend –¥–ª—è production
if (process.env.RESEND_API_KEY) {
    const { sendWelcomeEmailResend } = await import('@/lib/email-resend');
    sendWelcomeEmailResend(fullName, email, verificationUrl).catch(err => console.error('Verification email error:', err));
} else {
    sendWelcomeEmail(fullName, email, verificationUrl).catch(err => console.error('Verification email error:', err));
}
```

#### –®–∞–≥ 6: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ

```bash
git add .
git commit -m "feat: add Resend email support"
git push origin main
```

**–ü–ª—é—Å—ã Resend:**
- ‚úÖ 3,000 emails/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ù–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–ø–∞–º
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
POST https://andrewaltair.ge/api/auth/register
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Test123!@#",
  "fullName": "Test User"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·É£·Éö·Éò·Éê! ·Éí·Éó·ÉÆ·Éù·Éï·Éó ·É®·Éî·Éê·Éõ·Éù·É¨·Éõ·Éù·Éó ·Éó·É•·Éï·Éî·Éú·Éò ·Éî·Éö-·É§·Éù·É°·É¢·Éê...",
  "email": "test@example.com",
  "requiresVerification": true
}
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email

- **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:** –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Coolify
- **Gmail/Resend:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É test@example.com

### 3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤ email

–û—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `https://andrewaltair.ge/verify-email?token=abc123...`

### 4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏

```
POST https://andrewaltair.ge/api/auth/login
{
  "email": "test@example.com",
  "password": "Test123!@#"
}
```

**–î–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```json
{
  "error": "·Éí·Éó·ÉÆ·Éù·Éï·Éó ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éù·Éó ·Éó·É•·Éï·Éî·Éú·Éò ·Éî·Éö-·É§·Éù·É°·É¢·Éê",
  "requiresVerification": true
}
```

**–ü–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "user": { ... }
}
```

---

## üé® FRONTEND –°–¢–†–ê–ù–ò–¶–ê (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª: `src/app/verify-email/page.tsx`

```tsx
'use client'

import { useEffect, useState } from 'react'
import { useSearchParams, useRouter } from 'next/navigation'

export default function VerifyEmailPage() {
    const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading')
    const [message, setMessage] = useState('')
    const searchParams = useSearchParams()
    const router = useRouter()
    const token = searchParams.get('token')

    useEffect(() => {
        if (!token) {
            setStatus('error')
            setMessage('·Éï·Éî·É†·Éò·É§·Éò·Éô·Éê·É™·Éò·Éò·É° ·É¢·Éù·Éô·Éî·Éú·Éò ·Éê·É† ·Éê·É†·Éò·É° ·Éõ·Éò·Éó·Éò·Éó·Éî·Éë·É£·Éö·Éò')
            return
        }

        // Verify email
        fetch('/api/auth/verify-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    setStatus('success')
                    setMessage(data.message)
                    // Redirect to login after 3 seconds
                    setTimeout(() => router.push('/login'), 3000)
                } else {
                    setStatus('error')
                    setMessage(data.error)
                }
            })
            .catch(() => {
                setStatus('error')
                setMessage('·Éï·Éî·É†·Éò·É§·Éò·Éô·Éê·É™·Éò·Éê ·Éï·Éî·É† ·Éõ·Éù·ÉÆ·Éî·É†·ÉÆ·Éì·Éê')
            })
    }, [token, router])

    return (
        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900">
            <div className="max-w-md w-full bg-white/10 backdrop-blur-lg rounded-2xl p-8 text-center">
                {status === 'loading' && (
                    <>
                        <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
                        <h1 className="text-2xl font-bold text-white mb-2">·Éõ·Éò·Éõ·Éì·Éò·Éú·Éê·É†·Éî·Éù·Éë·É° ·Éï·Éî·É†·Éò·É§·Éò·Éô·Éê·É™·Éò·Éê...</h1>
                    </>
                )}
                
                {status === 'success' && (
                    <>
                        <div className="text-6xl mb-4">‚úÖ</div>
                        <h1 className="text-2xl font-bold text-white mb-2">·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·É£·Éö·Éò!</h1>
                        <p className="text-white/80">{message}</p>
                        <p className="text-white/60 text-sm mt-4">·Éí·Éê·Éì·Éê·Éõ·Éò·É°·Éê·Éõ·Éê·É†·Éó·Éî·Éë·Éê...</p>
                    </>
                )}
                
                {status === 'error' && (
                    <>
                        <div className="text-6xl mb-4">‚ùå</div>
                        <h1 className="text-2xl font-bold text-white mb-2">·É®·Éî·É™·Éì·Éù·Éõ·Éê</h1>
                        <p className="text-white/80">{message}</p>
                        <button 
                            onClick={() => router.push('/register')}
                            className="mt-6 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                        >
                            ·É£·Éô·Éê·Éú ·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê·Éñ·Éî
                        </button>
                    </>
                )}
            </div>
        </div>
    )
}
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```javascript
// MongoDB
db.users.find({ email: "test@example.com" }, { 
    isEmailVerified: 1, 
    emailVerificationToken: 1,
    emailVerificationExpires: 1 
})
```

### –õ–æ–≥–∏ Coolify

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
- `Verification email sent to: test@example.com`
- `Preview URL: https://ethereal.email/...` (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
- `Email sent successfully` (production)

---

## ‚ùì FAQ

### Q: Emails –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Gmail?

**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. App Password –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (16 —Å–∏–º–≤–æ–ª–æ–≤ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. 2FA –≤–∫–ª—é—á–µ–Ω–∞ –≤ Google –∞–∫–∫–∞—É–Ω—Ç–µ
3. `SMTP_USER` = –≤–∞—à –ø–æ–ª–Ω—ã–π email
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"

### Q: –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å verification email –ø–æ–≤—Ç–æ—Ä–Ω–æ?

**A:** –°–æ–∑–¥–∞–π—Ç–µ endpoint `/api/auth/resend-verification`:

```typescript
// –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await User.findOne({ email }).select('+emailVerificationToken');

// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ verified
if (user.isEmailVerified) {
    return NextResponse.json({ error: 'Email —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' });
}

// –û—Ç–ø—Ä–∞–≤—å—Ç–µ email –ø–æ–≤—Ç–æ—Ä–Ω–æ
const verificationUrl = `${process.env.NEXT_PUBLIC_APP_URL}/verify-email?token=${user.emailVerificationToken}`;
await sendWelcomeEmail(user.fullName, user.email, verificationUrl);
```

### Q: –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (24 —á–∞—Å–∞ –ø—Ä–æ—à–ª–æ)?

**A:** –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω:

```typescript
const crypto = await import('crypto');
user.emailVerificationToken = crypto.randomBytes(32).toString('hex');
user.emailVerificationExpires = new Date(Date.now() + 24 * 60 * 60 * 1000);
await user.save();
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** (Ethereal)

### –î–ª—è staging:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Gmail** (–±—ã—Å—Ç—Ä–æ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

### –î–ª—è production:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Resend** (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Coolify
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Environment Variables
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `NEXT_PUBLIC_APP_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/verify-email` —Å–æ–∑–¥–∞–Ω–∞

**–í—Å–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ email —Å–µ—Ä–≤–∏—Å.** üöÄ
