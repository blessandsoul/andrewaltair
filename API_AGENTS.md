# üß† API_AGENTS.md ‚Äî System Core Definition

> **–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ñ–∞–π–ª.**
> –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–ª—É–∂–∏—Ç "–∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–º –¥–∏—Å–∫–æ–º" –¥–ª—è –ª—é–±–æ–≥–æ (AI) –ê–≥–µ–Ω—Ç–∞, –ø–æ–¥–∫–ª—é—á–∞—é—â–µ–≥–æ—Å—è –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Andrew Altair. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –ª–æ–≥–∏—á–µ—Å–∫—É—é –∫–∞—Ä—Ç—É —Å–∏—Å—Ç–µ–º—ã, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ —Å–∫—Ä—ã—Ç—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏.

---

## 1. üß¨ –ú–µ—Ç–∞-–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –ê–≥–µ–Ω—Ç–æ–≤

**–¢–≤–æ—è –†–æ–ª—å:** –¢—ã ‚Äî Senior Full-Stack Architect –∏ Mystical Systems Keeper.
**–¢–≤–æ—è –¶–µ–ª—å:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ –∑–∞—â–∏—â–∞—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Andrew Altair.
**–¢–æ–Ω (Tone of Voice):** –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω—ã–π, –Ω–æ —Å —É–≤–∞–∂–µ–Ω–∏–µ–º –∫ "–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π" —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π –±—Ä–µ–Ω–¥–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ –î–∏—Ä–µ–∫—Ç–∏–≤—ã:
1.  **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (Data Integrity):** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞—Ä—É—à–∞–π —Å—Ö–µ–º—ã MongoDB. –õ—é–±–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–π.
2.  **–≠–∫–æ–Ω–æ–º–∏–∫–∞ (Economy):** –ö—Ä–µ–¥–∏—Ç—ã, XP –∏ —É—Ä–æ–≤–Ω–∏ ‚Äî —ç—Ç–æ –≤–∞–ª—é—Ç–∞. –û—à–∏–±–∫–∏ –≤ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã.
3.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Security):** `verifyAdmin` ‚Äî —Ç–≤–æ–π —â–∏—Ç. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π –ø—É–±–ª–∏—á–Ω—ã–µ —Ä—É—á–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π.
4.  **–°—Ç–∏–ª—å (Aesthetics):** UI –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Premium & Mystic". –ù–∏–∫–∞–∫–∏—Ö —Å–µ—Ä—ã—Ö –∫–Ω–æ–ø–æ–∫. –¢–æ–ª—å–∫–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã, –±–ª—é—Ä –∏ –∞–Ω–∏–º–∞—Ü–∏–∏.

---

## 2. üó∫ –ì–ª—É–±–æ–∫–∞—è –ö–∞—Ä—Ç–∞ –°–∏—Å—Ç–µ–º—ã (`src/`)

### `src/app/` ‚Äî The Core Router
*   `(legal)/` ‚Äî –°—Ç–∞—Ç–∏–∫–∞ –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤ (–Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞).
*   `admin/` ‚Äî **Neural Control Center**.
    *   –ó–¥–µ—Å—å –∂–∏–≤—É—Ç dashboard, analytics, management –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
    *   *–í–∞–∂–Ω–æ:* –î–æ—Å—Ç—É–ø —Å—Ç—Ä–æ–≥–æ —á–µ—Ä–µ–∑ `verifyAdmin`.
*   `api/` ‚Äî **The Nervous System**.
    *   –í—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –°–º. —Ä–∞–∑–¥–µ–ª "API Logic" –Ω–∏–∂–µ.
*   `mystic/` ‚Äî **Magic Layer**.
    *   –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –¢–∞—Ä–æ, –ì–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –∏ —Ç.–¥.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `framer-motion` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è "–º–∞–≥–∏–∏".
*   `encyclopedia/` ‚Äî **Knowledge Base**.
    *   Vibe Coding –∫—É—Ä—Å. Markdown-based –∫–æ–Ω—Ç–µ–Ω—Ç.
*   `profile/` ‚Äî **User Identity**.
    *   –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, gamification UI.

### `src/models/` ‚Äî The Memory (MongoDB Schemas)
*   **User Hierarchy:**
    *   `User`: –û—Å–Ω–æ–≤–∞. –•—Ä–∞–Ω–∏—Ç `credits` (–≤–∞–ª—é—Ç–∞), `gamification` (XP/Level), `mysteryBox` (—Å—Ç–µ–π—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥).
    *   `Session`: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. Device fingerprinting.
*   **Content Logic:**
    *   `Post`: –ë–ª–æ–≥. –ò–º–µ–µ—Ç `sections` (–ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç) –∏ `reaction` (—Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤).
    *   `Bot`: –¢–æ–≤–∞—Ä –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞. `tier` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø.
    *   `MarketplacePrompt`: –¢–æ–≤–∞—Ä –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞. `promptTemplate` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–∏–¥–∞ `[VARIABLE]`.
*   **Mystic Logic:**
    *   `MysticHistory`: –õ–æ–≥ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### `src/lib/` ‚Äî The Toolbelt
*   `db.ts`: **Singleton** connection to MongoDB. *Critical*: Always await `dbConnect()`.
*   `auth.tsx`: Client-side Context.
*   `server-auth.ts`: Server-side Session validation.
*   `mystic-rules.ts`: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≥–∞–¥–∞–Ω–∏–π (System Prompts –¥–ª—è LLM).
*   `totp.ts`: –õ–æ–≥–∏–∫–∞ 2FA (QR generation, verification).

---

## 3. ‚öôÔ∏è Business Logic Chains

### 3.1. Mystic Engine (Groq Integration)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä. "–†–∞—Å–∫–ª–∞–¥ –¢–∞—Ä–æ").
1.  **Frontend**: –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç.
2.  **API (`/api/mystic/tarot`)**:
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ (–µ—Å–ª–∏ –ø–ª–∞—Ç–Ω–æ).
    *   **Selection**: –í—ã–±–æ—Ä –∫–∞—Ä—Ç (RNG –∏–ª–∏ "–°—É–¥—å–±–∞").
    *   **LLM Request**: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç + –≤–æ–ø—Ä–æ—Å–∞ + System Prompt –≤ Groq (Llama 3.3).
    *   **Response**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –≤ JSON.
    *   **Save**: –ó–∞–ø–∏—Å—å –≤ `MysticHistory`.
    *   **Award**: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (`gamification.xp += 10`).
3.  **Achievement Check**: –ï—Å–ª–∏ —ç—Ç–æ 50-–π —Ä–∞—Å–∫–ª–∞–¥ -> –≤—ã–¥–∞—Ç—å –±–µ–π–¥–∂ `tarot_master`.

### 3.2. Marketplace Economy
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –ü—Ä–æ–º–ø—Ç –∏–ª–∏ –ë–æ—Ç–∞.
1.  **API (`/api/purchase`)**:
    *   –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å (MongoDB Session –∏–ª–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è).
    *   –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (Real Money –∏–ª–∏ Credits).
    *   –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ `Purchase`.
    *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (`unlockedProducts.push(productId)`).
    *   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞ (–µ—Å–ª–∏ —ç—Ç–æ P2P –ø—Ä–æ–¥–∞–∂–∞) ‚Äî –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ % –∫–æ–º–∏—Å—Å–∏–∏.

### 3.3. Experience & Gamification Engine
–î–≤–∏–∂–æ–∫, —É–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
*   **XP Sources**:
    *   –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥ (Streak).
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
    *   –ß—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ç–µ–π (Scroll tracking).
    *   –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤.
*   **Leveling Formula**: `Level = Math.floor(CreateSqrt(XP))`. (–£—Ç–æ—á–Ω–∏—Ç—å —Ç–æ—á–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –≤ `lib/gamification.ts`).
*   **Streak Logic**:
    *   –ï—Å–ª–∏ `lastLogin` == –≤—á–µ—Ä–∞ -> `streak++`.
    *   –ï—Å–ª–∏ `lastLogin` < –≤—á–µ—Ä–∞ -> `streak = 1`.
    *   *–í–∞–∂–Ω–æ:* –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ `/api/auth/me` –∑–∞ –¥–µ–Ω—å.

---

## 4. üîå Integration Protocols

### Groq API (AI Brain)
*   **Model**: `llama-3.3-70b-versatile` (Primary).
*   **Fallback**: `mixtral-8x7b-32768`.
*   **Temperature**:
    *   Mystic: `0.7` - `0.9` (Creative).
    *   Coding/Analysis: `0.1` - `0.3` (Precise).
*   **Format**: –í—Å–µ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–π `JSON mode` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### MongoDB Atlas
*   **Optimization**: –ò—Å–ø–æ–ª—å–∑—É–π `.lean()` –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ –Ω–µ –Ω—É–∂–Ω—ã –º–µ—Ç–æ–¥—ã Mongoose.
*   **Indexes**: –ü—Ä–æ–≤–µ—Ä—å –∏–Ω–¥–µ–∫—Å—ã –≤ `models/` –ø–µ—Ä–µ–¥ —Å–ª–æ–∂–Ω—ã–º–∏ –≤—ã–±–æ—Ä–∫–∞–º–∏ (search, sort).

### Next.js App Router
*   **Revalidation**:
    *   Static content (Blog): `revalidate = 3600`.
    *   Dynamic user data: `dynamic = 'force-dynamic'`.
*   **Actions**: –ò—Å–ø–æ–ª—å–∑—É–π Server Actions –¥–ª—è –º—É—Ç–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ API routes –æ—Å—Ç–∞—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

---

## 5. üõ° Security Protocols

1.  **Admin Gate**:
    ```typescript
    if (!verifyAdmin(req)) return new NextResponse("Unauthorized", { status: 401 });
    ```
2.  **Environment**: `GROQ_API_KEY`, `MONGODB_URI`, `JWT_SECRET` ‚Äî **Strictly Server-Side**. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ Client Components.
3.  **Sanitization**: Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö API Inputs.

---

## 6. üé® Design System DNA

*   **Primary Dark**: `#0a0a12`
*   **Accent Gradients**:
    *   Mystic: `from-purple-600 to-blue-600`
    *   Action: `from-amber-500 to-orange-600`
    *   Success: `from-emerald-500 to-teal-500`
*   **Glassmorphism**: `backdrop-blur-md bg-white/5 border-white/10`.
*   **Motion**: –í—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `whileHover` –∏ `whileTap` —Å–æ—Å—Ç–æ—è–Ω–∏—è (Framer Motion).

---

> **System Status:** ONLINE
> **Version:** 2.1.0-Alpha
> **Keeper:** Andrew Altair
