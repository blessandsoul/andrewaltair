"use strict";(()=>{var e={};e.id=5998,e.ids=[5998],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},86761:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{POST:()=>g});var i=r(49303),o=r(88716),s=r(60670),a=r(87070);let u=require("fs/promises");var p=r(71017),l=r.n(p),c=r(45898);let d=["image/jpeg","image/png","image/webp","image/gif"];async function g(e){try{if(!await (0,c.ZW)(e))return(0,c.m)("Admin access required");let t=await e.formData(),r=t.get("file"),n=t.get("title")||"untitled",i=t.get("type")||"horizontal";if(!r)return a.NextResponse.json({error:"No file uploaded"},{status:400});if(!d.includes(r.type))return a.NextResponse.json({error:"დაშვებულია მხოლოდ სურათები (JPEG, PNG, WEBP, GIF)"},{status:400});if(r.size>5242880)return a.NextResponse.json({error:"ფაილის ზომა არ უნდა აღემატებოდეს 5MB-ს"},{status:400});let o=function(e){let t=e.toLowerCase();for(let[e,r]of Object.entries({ა:"a",ბ:"b",გ:"g",დ:"d",ე:"e",ვ:"v",ზ:"z",თ:"t",ი:"i",კ:"k",ლ:"l",მ:"m",ნ:"n",ო:"o",პ:"p",ჟ:"zh",რ:"r",ს:"s",ტ:"t",უ:"u",ფ:"p",ქ:"q",ღ:"gh",ყ:"y",შ:"sh",ჩ:"ch",ც:"ts",ძ:"dz",წ:"ts",ჭ:"ch",ხ:"kh",ჯ:"j",ჰ:"h"}))t=t.replace(RegExp(e,"g"),r);return t.replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim().slice(0,60)}(n),s=r.name.split(".").pop()||"jpg",p=new Date,g=p.getFullYear(),m=String(p.getMonth()+1).padStart(2,"0"),f=`${o}-${i}.${s}`,h=l().join(process.cwd(),"public","uploads",String(g),m),x=l().join(h,f);await (0,u.mkdir)(h,{recursive:!0});let v=Buffer.from(await r.arrayBuffer());await (0,u.writeFile)(x,v);let w=`/uploads/${g}/${m}/${f}`;return a.NextResponse.json({success:!0,url:w,filename:f,type:i})}catch(e){return console.error("Upload error:",e),a.NextResponse.json({error:"Upload failed"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\upload\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:x}=m,v="/api/upload/route";function w(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},45898:(e,t,r)=>{r.d(t,{Oh:()=>c,ZW:()=>p,m:()=>d,p$:()=>l}),r(71615);var n=r(41482),i=r.n(n);let o=process.env.ADMIN_PASSWORD,s=process.env.ADMIN_SESSION_SECRET;function a(){if(!s)throw Error("ADMIN_SESSION_SECRET environment variable is required");return s}let u=new Map;function p(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return!1;let r=t.substring(7),n=i().verify(r,a());return"admin"===n.role||"god"===n.role}catch{return!1}}function l(e,t){let r=u.get(t),n=Date.now();if(r&&r.count>=5){let e=n-r.lastAttempt;if(e<9e5)return{valid:!1,locked:!0,remainingAttempts:0,lockoutRemaining:Math.ceil((9e5-e)/1e3)};u.delete(t)}if(!o)return console.error("⚠️ ADMIN_PASSWORD not set in environment!"),{valid:!1,locked:!1,remainingAttempts:0};if(e===o)return u.delete(t),{valid:!0,locked:!1,remainingAttempts:5};let i=u.get(t)||{count:0,lastAttempt:n};return i.count++,i.lastAttempt=n,u.set(t,i),{valid:!1,locked:!1,remainingAttempts:5-i.count}}function c(){return i().sign({role:"admin",iat:Date.now()},a(),{expiresIn:"24h"})}function d(e="Unauthorized"){return new Response(JSON.stringify({error:e}),{status:401,headers:{"Content-Type":"application/json"}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,1482,1615],()=>r(86761));module.exports=n})();