"use strict";(()=>{var e={};e.id=1772,e.ids=[1772],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},56311:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>A,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>v});var n=r(49303),o=r(88716),i=r(60670),a=r(87070),u=r(41482),d=r.n(u),p=r(75748),l=r(37789);let c=process.env.JWT_SECRET;if(!c)throw Error("JWT_SECRET environment variable is required");async function v(e){try{await (0,p.Z)();let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.substring(7),s=d().verify(r,c),n=await l.Z.find({userId:s.userId,isActive:!0,expiresAt:{$gt:new Date}}).sort({lastActivity:-1}).lean();return a.NextResponse.json({sessions:n.map(e=>({id:e._id.toString(),deviceInfo:e.deviceInfo,lastActivity:e.lastActivity,createdAt:e.createdAt,isCurrent:e.token===r}))})}catch(e){return console.error("Get sessions error:",e),a.NextResponse.json({error:"Failed to get sessions"},{status:500})}}async function f(e){try{await (0,p.Z)();let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.substring(7),s=d().verify(r,c),{searchParams:n}=new URL(e.url),o=n.get("id"),i="true"===n.get("all"),u="true"===n.get("exceptCurrent");if(i){let e={userId:s.userId};u&&(e.token={$ne:r});let t=await l.Z.updateMany(e,{isActive:!1});return a.NextResponse.json({success:!0,message:`Revoked ${t.modifiedCount} sessions`})}if(o){if(!await l.Z.findOneAndUpdate({_id:o,userId:s.userId},{isActive:!1},{new:!0}))return a.NextResponse.json({error:"Session not found"},{status:404});return a.NextResponse.json({success:!0,message:"Session revoked"})}return a.NextResponse.json({error:"Specify session ID or all=true"},{status:400})}catch(e){return console.error("Delete session error:",e),a.NextResponse.json({error:"Failed to revoke session"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\sessions\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:h}=m,y="/api/sessions/route";function A(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},75748:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(11185),n=r.n(s);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let a=async function(){if(i.conn)return i.conn;i.promise||(i.promise=n().connect(o,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},37789:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(11185),n=r.n(s);let o=new s.Schema({userId:{type:s.Schema.Types.ObjectId,ref:"User",required:!0,index:!0},token:{type:String,required:!0,unique:!0},deviceInfo:{browser:String,os:String,device:String,ip:String},isActive:{type:Boolean,default:!0},lastActivity:{type:Date,default:Date.now},expiresAt:{type:Date,required:!0}},{timestamps:!0});o.index({expiresAt:1},{expireAfterSeconds:0}),o.index({userId:1,isActive:1});let i=n().models.Session||n().model("Session",o)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1482],()=>r(56311));module.exports=s})();