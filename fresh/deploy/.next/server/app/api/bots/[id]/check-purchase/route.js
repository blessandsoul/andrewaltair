"use strict";(()=>{var e={};e.id=4365,e.ids=[4365],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},29233:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>b,serverHooks:()=>S,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>g});var s=r(49303),i=r(88716),n=r(60670),o=r(87070),d=r(41482),u=r.n(d),l=r(14184),p=r(11185),c=r.n(p);let m=new p.Schema({botId:{type:String,required:!0,index:!0},userEmail:{type:String,required:!0,index:!0},userId:{type:String},amount:{type:Number,required:!0},status:{type:String,enum:["pending","completed","failed","refunded"],default:"pending",index:!0},paymentMethod:{type:String},transactionId:{type:String,unique:!0,sparse:!0},purchasedAt:{type:Date,default:Date.now}});m.index({botId:1,userEmail:1,status:1});let h=c().models.Purchase||c().model("Purchase",m);var f=r(93330);let y=process.env.JWT_SECRET||"fallback-secret";async function g(e,{params:t}){try{await (0,l.Z)();let a=(await r.e(1377).then(r.bind(r,61377))).default,s=await a.findById(t.id);if(s?.tier==="free")return o.NextResponse.json({hasPurchased:!0});let i=e.headers.get("authorization");if(!i||!i.startsWith("Bearer "))return o.NextResponse.json({hasPurchased:!1});let n=i.substring(7),d=null;try{let e=u().verify(n,y),t=await f.Z.findById(e.userId);t&&(d=t.email)}catch(e){return console.error("Token verification failed:",e),o.NextResponse.json({hasPurchased:!1})}if(!d)return o.NextResponse.json({hasPurchased:!1});let p=await h.findOne({botId:t.id,userEmail:d,status:"completed"});return o.NextResponse.json({hasPurchased:!!p})}catch(e){return console.error("Error checking purchase:",e),o.NextResponse.json({hasPurchased:!1})}}let b=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bots/[id]/check-purchase/route",pathname:"/api/bots/[id]/check-purchase",filename:"route",bundlePath:"app/api/bots/[id]/check-purchase/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\bots\\[id]\\check-purchase\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:v,serverHooks:S}=b,x="/api/bots/[id]/check-purchase/route";function q(){return(0,n.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:v})}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),s=r.n(a);let i=process.env.MONGODB_URI||"mongodb://localhost:27017/andrewaltair";if(!i)throw Error("Please define the MONGODB_URI environment variable");let n=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=n);let o=async function(){if(n.conn)return n.conn;n.promise||(n.promise=s().connect(i,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},93330:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),s=r.n(a),i=r(98691);let n=new a.Schema({username:{type:String,required:[!0,"Username is required"],unique:!0,trim:!0,minlength:[3,"Username must be at least 3 characters"],maxlength:[30,"Username must be less than 30 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"],select:!1},fullName:{type:String,required:[!0,"Full name is required"],trim:!0},bio:{type:String,default:void 0},avatar:{type:String,default:void 0},coverImage:{type:String,default:void 0},coverOffsetY:{type:Number,default:0},role:{type:String,enum:["god","admin","editor","viewer"],default:"viewer"},badge:{type:String,default:void 0},isBlocked:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1},twoFactorSecret:{type:String,select:!1},backupCodes:{type:[String],select:!1},lastLogin:{type:Date,default:void 0},credits:{type:Number,default:0},mysteryBox:{lastClaimedAt:{type:Date},streak:{type:Number,default:0}},gamification:{xp:{type:Number,default:0},level:{type:Number,default:1},streak:{type:Number,default:0},completedQuests:[{type:String}],completedLessons:[{type:String}],unlockedSkills:{type:[String],default:["prompt-basics"]}}},{timestamps:!0});n.pre("save",async function(){if(!this.isModified("password"))return;let e=await i.ZP.genSalt(10);this.password=await i.ZP.hash(this.password,e)}),n.methods.comparePassword=async function(e){return i.ZP.compare(e,this.password)},n.statics.findByCredentials=async function(e,t){let r=await this.findOne({email:e}).select("+password");if(!r||!await r.comparePassword(t))throw Error("Invalid credentials");return r};let o=s().models.User||s().model("User",n)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,8691,1482],()=>r(29233));module.exports=a})();