"use strict";(()=>{var e={};e.id=2672,e.ids=[2672],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},14773:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{POST:()=>c});var s=r(49303),i=r(88716),o=r(60670),a=r(87070),u=r(45898);async function c(e){try{let{password:t}=await e.json();if(!t)return a.NextResponse.json({error:"პაროლი აუცილებელია",success:!1},{status:400});let r=e.headers.get("x-forwarded-for")?.split(",")[0]||e.headers.get("x-real-ip")||"unknown",n=(0,u.p$)(t,r);if(n.locked)return a.NextResponse.json({error:`ძალიან ბევრი მცდელობა. სცადეთ ${Math.ceil((n.lockoutRemaining||0)/60)} წუთში.`,locked:!0,lockoutRemaining:n.lockoutRemaining,success:!1},{status:429});if(!n.valid)return a.NextResponse.json({error:"არასწორი პაროლი",remainingAttempts:n.remainingAttempts,success:!1},{status:401});let s=(0,u.Oh)(),i=a.NextResponse.json({success:!0,token:s,message:"წარმატებით შეხვედით"});return i.cookies.set("admin_session",s,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400}),i}catch(e){return console.error("Admin login error:",e),a.NextResponse.json({error:"შესვლა ვერ მოხერხდა",success:!1},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/login/route",pathname:"/api/admin/login",filename:"route",bundlePath:"app/api/admin/login/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\admin\\login\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=l,g="/api/admin/login/route";function x(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},45898:(e,t,r)=>{r.d(t,{Oh:()=>p,ZW:()=>c,m:()=>d,p$:()=>l}),r(71615);var n=r(41482),s=r.n(n);let i=process.env.ADMIN_PASSWORD,o=process.env.ADMIN_SESSION_SECRET;function a(){if(!o)throw Error("ADMIN_SESSION_SECRET environment variable is required");return o}let u=new Map;function c(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return!1;let r=t.substring(7),n=s().verify(r,a());return"admin"===n.role||"god"===n.role}catch{return!1}}function l(e,t){let r=u.get(t),n=Date.now();if(r&&r.count>=5){let e=n-r.lastAttempt;if(e<9e5)return{valid:!1,locked:!0,remainingAttempts:0,lockoutRemaining:Math.ceil((9e5-e)/1e3)};u.delete(t)}if(!i)return console.error("⚠️ ADMIN_PASSWORD not set in environment!"),{valid:!1,locked:!1,remainingAttempts:0};if(e===i)return u.delete(t),{valid:!0,locked:!1,remainingAttempts:5};let s=u.get(t)||{count:0,lastAttempt:n};return s.count++,s.lastAttempt=n,u.set(t,s),{valid:!1,locked:!1,remainingAttempts:5-s.count}}function p(){return s().sign({role:"admin",iat:Date.now()},a(),{expiresIn:"24h"})}function d(e="Unauthorized"){return new Response(JSON.stringify({error:e}),{status:401,headers:{"Content-Type":"application/json"}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,1482,1615],()=>r(14773));module.exports=n})();