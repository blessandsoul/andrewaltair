"use strict";(()=>{var e={};e.id=1561,e.ids=[1561],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25234:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var t={};r.r(t),r.d(t,{GET:()=>d,POST:()=>c});var o=r(49303),n=r(88716),a=r(60670),u=r(87070);let i=new Map;async function c(e){try{let{articleId:s,userId:r}=await e.json();if(!s)return u.NextResponse.json({success:!1,error:"Article ID is required"},{status:400});let t=function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",s="";for(let r=0;r<8;r++)s+=e.charAt(Math.floor(Math.random()*e.length));return s}(),o=Date.now(),n=o+9e5;return i.set(t,{articleId:s,expiresAt:n,used:!1,createdAt:o,sharedBy:r}),p(),u.NextResponse.json({success:!0,code:t,articleId:s,expiresAt:n,expiresIn:9e5})}catch(e){return u.NextResponse.json({success:!1,error:"Failed to generate share code"},{status:500})}}async function d(e){let s=e.nextUrl.searchParams.get("code");if(!s)return u.NextResponse.json({success:!1,error:"Code is required"},{status:400});let r=i.get(s);if(!r)return u.NextResponse.json({success:!1,error:"Неверный код или код уже использован"});let t=Date.now();return t>r.expiresAt?(i.delete(s),u.NextResponse.json({success:!1,error:"Код истек (15 минут прошло)"})):r.used?u.NextResponse.json({success:!1,error:"Этот код уже был использован"}):(r.used=!0,u.NextResponse.json({success:!0,articleId:r.articleId,expiresAt:t+9e5,remainingTime:9e5,message:"У вас есть 15 минут доступа к этой статье"}))}function p(){let e=Date.now();for(let[s,r]of i.entries())(e>r.expiresAt||r.used)&&i.delete(s)}setInterval(p,3e5);let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/vibe-codes/share-unlock/route",pathname:"/api/vibe-codes/share-unlock",filename:"route",bundlePath:"app/api/vibe-codes/share-unlock/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\vibe-codes\\share-unlock\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:f}=l,m="/api/vibe-codes/share-unlock/route";function v(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[8948,5972],()=>r(25234));module.exports=t})();