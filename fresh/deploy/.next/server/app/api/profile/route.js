"use strict";(()=>{var e={};e.id=442,e.ids=[442,3959],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},78202:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>S,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>c,PUT:()=>f});var i=r(49303),n=r(88716),o=r(60670),s=r(87070),l=r(75748),d=r(93330),u=r(23959),p=r(84283);function m(e){let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return null;let a=t.split(" ")[1];try{let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET is not defined");return r(41482).verify(a,e)}catch{return null}}async function c(e){try{let t=m(e);if(!t)return s.NextResponse.json({error:"Unauthorized"},{status:401});await (0,l.Z)();let r=await d.Z.findById(t.userId).lean();if(!r)return s.NextResponse.json({error:"User not found"},{status:404});let a=await p.Z.find({email:r.email}).sort({createdAt:-1}).limit(10).lean(),i=await u.default.find({status:"published"}).sort({createdAt:-1}).limit(5).select("title slug views createdAt").lean(),n=[{id:"login-1",type:"login",description:"სისტემაში შესვლა",time:new Date().toISOString()},...a.slice(0,5).map((e,t)=>({id:`comment-${t}`,type:"comment",description:`კომენტარი: "${e.content?.substring(0,50)}..."`,time:e.createdAt}))],o={totalTimeSpent:`${Math.floor(24*Math.random())+1} საათი`,sessionsCount:Math.floor(50*Math.random())+10,lastActive:new Date().toISOString(),pagesVisited:Math.floor(200*Math.random())+50,toolsUsed:Math.floor(30*Math.random())+5,commentsPosted:a.length,likesGiven:Math.floor(50*Math.random())+10,topSections:[{name:"ბლოგი",visits:Math.floor(100*Math.random())+30},{name:"ინსტრუმენტები",visits:Math.floor(80*Math.random())+20},{name:"ვიდეოები",visits:Math.floor(60*Math.random())+15}]},c=[{id:"google",name:"Google",connected:!!r.googleId,icon:"Chrome",color:"bg-red-500"},{id:"facebook",name:"Facebook",connected:!!r.facebookId,icon:"Facebook",color:"bg-blue-600"},{id:"telegram",name:"Telegram",connected:!!r.telegramId,icon:"Send",color:"bg-sky-500"}];return s.NextResponse.json({user:{id:r._id.toString(),username:r.username,email:r.email,fullName:r.fullName,avatar:r.avatar,coverImage:r.coverImage,coverOffsetY:r.coverOffsetY,role:r.role,badge:r.badge,createdAt:r.createdAt},activity:n,stats:o,socialAccounts:c,subscriptions:[{id:1,name:"ChatGPT",type:"tool",subscribed:!0},{id:2,name:"Midjourney",type:"tool",subscribed:!0},{id:3,name:"AI News",type:"topic",subscribed:!0},{id:4,name:"Gemini",type:"tool",subscribed:!1}],recentPosts:i.map(e=>({id:e._id.toString(),title:e.title,slug:e.slug,views:e.views,createdAt:e.createdAt}))})}catch(e){return console.error("Profile API error:",e),s.NextResponse.json({error:"Failed to fetch profile"},{status:500})}}async function f(e){try{let t=m(e);if(!t)return s.NextResponse.json({error:"Unauthorized"},{status:401});await (0,l.Z)();let r=await e.json(),a={};void 0!==r.fullName&&(a.fullName=r.fullName),void 0!==r.avatar&&(a.avatar=r.avatar),void 0!==r.coverImage&&(a.coverImage=r.coverImage),void 0!==r.coverOffsetY&&(a.coverOffsetY=r.coverOffsetY),void 0!==r.bio&&(a.bio=r.bio),void 0!==r.website&&(a.website=r.website),void 0!==r.publicProfile&&(a.publicProfile=r.publicProfile);let i=await d.Z.findByIdAndUpdate(t.userId,{$set:a},{new:!0,runValidators:!0}).lean();if(!i)return s.NextResponse.json({error:"User not found"},{status:404});return s.NextResponse.json({user:{id:i._id.toString(),username:i.username,email:i.email,fullName:i.fullName,avatar:i.avatar,coverImage:i.coverImage,coverOffsetY:i.coverOffsetY,role:i.role,badge:i.badge},message:"Profile updated successfully"})}catch(e){return console.error("Profile update error:",e),s.NextResponse.json({error:"Failed to update profile"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/profile/route",pathname:"/api/profile",filename:"route",bundlePath:"app/api/profile/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\profile\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:S}=g,v="/api/profile/route";function b(){return(0,o.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:h})}},75748:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),i=r.n(a);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=o);let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=i().connect(n,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},84283:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),i=r.n(a);let n=new a.Schema({postId:{type:String,required:[!0,"Post ID is required"],index:!0},author:{name:{type:String,required:!0},email:{type:String},avatar:{type:String},userId:{type:a.Schema.Types.ObjectId,ref:"User"}},content:{type:String,required:[!0,"Content is required"],trim:!0,maxlength:[2e3,"Comment must be less than 2000 characters"]},likes:{type:Number,default:0},parentId:{type:a.Schema.Types.ObjectId,ref:"Comment",default:null},status:{type:String,enum:["pending","approved","rejected","spam"],default:"pending"},isSpam:{type:Boolean,default:!1}},{timestamps:!0});n.index({parentId:1});let o=i().models.Comment||i().model("Comment",n)},23959:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var a=r(11185),i=r.n(a);let n=new a.Schema({fire:{type:Number,default:0},love:{type:Number,default:0},mindblown:{type:Number,default:0},applause:{type:Number,default:0},insightful:{type:Number,default:0}},{_id:!1}),o=new a.Schema({metaTitle:{type:String,maxlength:60},metaDescription:{type:String,maxlength:160},keywords:{type:String},canonicalUrl:{type:String},focusKeyword:{type:String},seoScore:{type:Number,min:0,max:100},ogImage:{type:String}},{_id:!1}),s=new a.Schema({name:{type:String,required:!0},avatar:{type:String},role:{type:String}},{_id:!1}),l=new a.Schema({icon:{type:String},title:{type:String},content:{type:String,required:!0},type:{type:String,enum:["intro","section","sarcasm","warning","tip","fact","opinion","cta","hashtags","prompt","author-comment"],default:"section"}},{_id:!1}),d=new a.Schema({horizontal:{type:String},vertical:{type:String}},{_id:!1}),u=new a.Schema({src:{type:String,required:!0},alt:{type:String},caption:{type:String}},{_id:!1}),p=new a.Schema({url:{type:String,required:!0},platform:{type:String,enum:["youtube","vimeo"],required:!0},videoId:{type:String},thumbnailUrl:{type:String}},{_id:!1}),m=new a.Schema({slug:{type:String,required:[!0,"Slug is required"],unique:!0,trim:!0},title:{type:String,required:[!0,"Title is required"],trim:!0},excerpt:{type:String,required:[!0,"Excerpt is required"],trim:!0},content:{type:String,default:""},rawContent:{type:String,default:""},coverImage:{type:String},coverImages:{type:d},gallery:{type:[u],default:[]},sections:{type:[l],default:[]},category:{type:String,required:[!0,"Category is required"],index:!0},tags:{type:[String],default:[]},author:{type:s,required:!0},publishedAt:{type:Date,default:Date.now},readingTime:{type:Number,default:5},views:{type:Number,default:0},comments:{type:Number,default:0},shares:{type:Number,default:0},reactions:{type:n,default:()=>({fire:0,love:0,mindblown:0,applause:0,insightful:0})},featured:{type:Boolean,default:!1},trending:{type:Boolean,default:!1},status:{type:String,enum:["draft","published","scheduled","archived"],default:"draft",index:!0},scheduledFor:{type:Date},order:{type:Number,default:0},seo:{type:o,default:()=>({})},videos:{type:[p],default:[]},relatedPosts:{type:[String],default:[]},numericId:{type:String,unique:!0,sparse:!0,index:!0}},{timestamps:!0});m.index({title:"text",excerpt:"text",content:"text",rawContent:"text",numericId:"text"});let c=i().models.Post||i().model("Post",m)},93330:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),i=r.n(a),n=r(98691);let o=new a.Schema({username:{type:String,required:[!0,"Username is required"],unique:!0,trim:!0,minlength:[3,"Username must be at least 3 characters"],maxlength:[30,"Username must be less than 30 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"],select:!1},fullName:{type:String,required:[!0,"Full name is required"],trim:!0},bio:{type:String,default:void 0},avatar:{type:String,default:void 0},coverImage:{type:String,default:void 0},coverOffsetY:{type:Number,default:0},role:{type:String,enum:["god","admin","editor","viewer"],default:"viewer"},badge:{type:String,default:void 0},isBlocked:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1},twoFactorSecret:{type:String,select:!1},backupCodes:{type:[String],select:!1},lastLogin:{type:Date,default:void 0},credits:{type:Number,default:0},mysteryBox:{lastClaimedAt:{type:Date},streak:{type:Number,default:0}},gamification:{xp:{type:Number,default:0},level:{type:Number,default:1},streak:{type:Number,default:0},completedQuests:[{type:String}],completedLessons:[{type:String}],unlockedSkills:{type:[String],default:["prompt-basics"]}}},{timestamps:!0});o.pre("save",async function(){if(!this.isModified("password"))return;let e=await n.ZP.genSalt(10);this.password=await n.ZP.hash(this.password,e)}),o.methods.comparePassword=async function(e){return n.ZP.compare(e,this.password)},o.statics.findByCredentials=async function(e,t){let r=await this.findOne({email:e}).select("+password");if(!r||!await r.comparePassword(t))throw Error("Invalid credentials");return r};let s=i().models.User||i().model("User",o)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,8691,1482],()=>r(78202));module.exports=a})();