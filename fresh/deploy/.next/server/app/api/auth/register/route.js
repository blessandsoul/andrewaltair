"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},10345:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>f});var a=t(49303),o=t(88716),i=t(60670),n=t(87070),l=t(41482),u=t.n(l),p=t(75748),d=t(93330),c=t(20471);let m=process.env.JWT_SECRET;if(!m)throw Error("JWT_SECRET environment variable is required");async function f(e){try{await (0,p.Z)();let{username:r,email:t,password:s,fullName:a}=await e.json();if(!r||!t||!s||!a)return n.NextResponse.json({error:"áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ áƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒáƒ"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return n.NextResponse.json({error:"áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ¤áƒáƒ áƒ›áƒáƒ¢áƒ˜"},{status:400});if(s.length<8)return n.NextResponse.json({error:"áƒáƒáƒ áƒáƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒ£áƒ› 8 áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ"},{status:400});if(!/^[a-zA-Z0-9_]+$/.test(r))return n.NextResponse.json({error:"áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ¨áƒ”áƒ˜áƒªáƒáƒ•áƒ“áƒ”áƒ¡ áƒ›áƒ®áƒáƒšáƒáƒ“ áƒšáƒáƒ—áƒ˜áƒœáƒ£áƒ  áƒáƒ¡áƒáƒ”áƒ‘áƒ¡, áƒªáƒ˜áƒ¤áƒ áƒ”áƒ‘áƒ¡ áƒ“áƒ _"},{status:400});let o=await d.Z.findOne({$or:[{email:t},{username:r}]});if(o){if(o.email===t)return n.NextResponse.json({error:"áƒ”áƒ¡ áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ áƒ£áƒ™áƒ•áƒ” áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ"},{status:400});return n.NextResponse.json({error:"áƒ”áƒ¡ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ£áƒ™áƒ•áƒ” áƒ“áƒáƒ™áƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ"},{status:400})}let i=new d.Z({username:r,email:t,password:s,fullName:a,role:"viewer"});await i.save(),(0,c.Pi)(a,t).catch(e=>console.error("Welcome email error:",e));let l=u().sign({userId:i._id,role:i.role},m,{expiresIn:"7d"}),f={id:i._id.toString(),username:i.username,email:i.email,fullName:i.fullName,avatar:i.avatar,role:i.role,badge:i.badge,createdAt:i.createdAt.toISOString()};return n.NextResponse.json({success:!0,user:f,token:l})}catch(e){return console.error("Registration error:",e),n.NextResponse.json({error:"áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:x}=h,y="/api/auth/register/route";function S(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},75748:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(11185),a=t.n(s);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let n=async function(){if(i.conn)return i.conn;i.promise||(i.promise=a().connect(o,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},20471:(e,r,t)=>{t.d(r,{Cz:()=>i,L6:()=>l,Pi:()=>n});var s=t(55245);let a=async()=>{if(process.env.SMTP_HOST&&process.env.SMTP_USER&&process.env.SMTP_PASS)return s.createTransport({host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587"),secure:"true"===process.env.SMTP_SECURE,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});let e=await s.createTestAccount();return s.createTransport({host:"smtp.ethereal.email",port:587,secure:!1,auth:{user:e.user,pass:e.pass}})},o={welcome:(e,r)=>({subject:"áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ— Fresh-áƒ–áƒ”! \uD83C\uDF89",html:`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                <h1 style="color: #6366f1;">áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ, ${e}! ğŸ‘‹</h1>
                <p>áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ áƒ áƒáƒ› áƒ“áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ“áƒ˜áƒ— Fresh áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒáƒ–áƒ”.</p>
                <p>áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ: <strong>${r}</strong></p>
                <div style="margin: 30px 0;">
                    <a href="${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}" 
                       style="background: #6366f1; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px;">
                        áƒ’áƒáƒ“áƒáƒ•áƒ˜áƒ“áƒ”áƒ— áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒáƒ–áƒ”
                    </a>
                </div>
                <p style="color: #666; font-size: 12px;">Fresh Team</p>
            </div>
        `}),notification:(e,r,t,s)=>({subject:e,html:`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #6366f1;">${e}</h2>
                <p>${r}</p>
                ${t?`
                    <div style="margin: 30px 0;">
                        <a href="${t}" 
                           style="background: #6366f1; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px;">
                            ${s||"áƒ’áƒáƒ“áƒáƒ¡áƒ•áƒšáƒ"}
                        </a>
                    </div>
                `:""}
                <p style="color: #666; font-size: 12px;">Fresh Team</p>
            </div>
        `})};async function i({to:e,subject:r,html:t,text:o}){try{let i=await a(),n=await i.sendMail({from:process.env.SMTP_FROM||'"Fresh Platform" <noreply@fresh.ge>',to:Array.isArray(e)?e.join(", "):e,subject:r,text:o||r,html:t}),l=s.getTestMessageUrl(n);return{success:!0,messageId:n.messageId,previewUrl:l||void 0}}catch(e){return console.error("Email send error:",e),{success:!1,error:e instanceof Error?e.message:"Email send failed"}}}async function n(e,r){let t=o.welcome(e,r);return i({to:r,...t})}async function l(e,r,t,s,a){return i({to:e,...o.notification(r,t,s,a)})}},93330:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(11185),a=t.n(s),o=t(98691);let i=new s.Schema({username:{type:String,required:[!0,"Username is required"],unique:!0,trim:!0,minlength:[3,"Username must be at least 3 characters"],maxlength:[30,"Username must be less than 30 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"],select:!1},fullName:{type:String,required:[!0,"Full name is required"],trim:!0},bio:{type:String,default:void 0},avatar:{type:String,default:void 0},coverImage:{type:String,default:void 0},coverOffsetY:{type:Number,default:0},role:{type:String,enum:["god","admin","editor","viewer"],default:"viewer"},badge:{type:String,default:void 0},isBlocked:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1},twoFactorSecret:{type:String,select:!1},backupCodes:{type:[String],select:!1},lastLogin:{type:Date,default:void 0},credits:{type:Number,default:0},mysteryBox:{lastClaimedAt:{type:Date},streak:{type:Number,default:0}},gamification:{xp:{type:Number,default:0},level:{type:Number,default:1},streak:{type:Number,default:0},completedQuests:[{type:String}],completedLessons:[{type:String}],unlockedSkills:{type:[String],default:["prompt-basics"]}}},{timestamps:!0});i.pre("save",async function(){if(!this.isModified("password"))return;let e=await o.ZP.genSalt(10);this.password=await o.ZP.hash(this.password,e)}),i.methods.comparePassword=async function(e){return o.ZP.compare(e,this.password)},i.statics.findByCredentials=async function(e,r){let t=await this.findOne({email:e}).select("+password");if(!t||!await t.comparePassword(r))throw Error("Invalid credentials");return t};let n=a().models.User||a().model("User",i)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,8691,1482,5245],()=>t(10345));module.exports=s})();