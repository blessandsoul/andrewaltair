"use strict";(()=>{var e={};e.id=8788,e.ids=[8788],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},15048:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>f});var s=r(49303),i=r(88716),n=r(60670),o=r(87070),u=r(41482),d=r.n(u),l=r(75748),p=r(93330),c=r(37789);let m=process.env.JWT_SECRET||"fallback-secret";async function f(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return o.NextResponse.json({error:"არ ხართ ავტორიზებული"},{status:401});let r=t.substring(7);try{let e=d().verify(r,m);await (0,l.Z)();let t=await c.Z.findOne({token:r,userId:e.userId,isActive:!0,expiresAt:{$gt:new Date}});if(!t)return o.NextResponse.json({error:"სესია ვადაგასულია ან არ არსებობს"},{status:401});await c.Z.findByIdAndUpdate(t._id,{lastActivity:new Date});let a=await p.Z.findById(e.userId);if(!a)return o.NextResponse.json({error:"მომხმარებელი ვერ მოიძებნა"},{status:404});if(a.isBlocked)return o.NextResponse.json({error:"თქვენი ანგარიში დაბლოკილია"},{status:403});let s={id:a._id.toString(),username:a.username,email:a.email,fullName:a.fullName,avatar:a.avatar,coverImage:a.coverImage,coverOffsetY:a.coverOffsetY,role:a.role,badge:a.badge,createdAt:a.createdAt.toISOString()};return o.NextResponse.json({user:s})}catch{return o.NextResponse.json({error:"არასწორი ტოკენი"},{status:401})}}catch(e){return console.error("Auth check error:",e),o.NextResponse.json({error:"სერვერის შეცდომა"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\auth\\me\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:v}=g,S="/api/auth/me/route";function w(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}},75748:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),s=r.n(a);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=n);let o=async function(){if(n.conn)return n.conn;n.promise||(n.promise=s().connect(i,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},37789:(e,t,r)=>{r.d(t,{Z:()=>n});var a=r(11185),s=r.n(a);let i=new a.Schema({userId:{type:a.Schema.Types.ObjectId,ref:"User",required:!0,index:!0},token:{type:String,required:!0,unique:!0},deviceInfo:{browser:String,os:String,device:String,ip:String},isActive:{type:Boolean,default:!0},lastActivity:{type:Date,default:Date.now},expiresAt:{type:Date,required:!0}},{timestamps:!0});i.index({expiresAt:1},{expireAfterSeconds:0}),i.index({userId:1,isActive:1});let n=s().models.Session||s().model("Session",i)},93330:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),s=r.n(a),i=r(98691);let n=new a.Schema({username:{type:String,required:[!0,"Username is required"],unique:!0,trim:!0,minlength:[3,"Username must be at least 3 characters"],maxlength:[30,"Username must be less than 30 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"],select:!1},fullName:{type:String,required:[!0,"Full name is required"],trim:!0},bio:{type:String,default:void 0},avatar:{type:String,default:void 0},coverImage:{type:String,default:void 0},coverOffsetY:{type:Number,default:0},role:{type:String,enum:["god","admin","editor","viewer"],default:"viewer"},badge:{type:String,default:void 0},isBlocked:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1},twoFactorSecret:{type:String,select:!1},backupCodes:{type:[String],select:!1},lastLogin:{type:Date,default:void 0},credits:{type:Number,default:0},mysteryBox:{lastClaimedAt:{type:Date},streak:{type:Number,default:0}},gamification:{xp:{type:Number,default:0},level:{type:Number,default:1},streak:{type:Number,default:0},completedQuests:[{type:String}],completedLessons:[{type:String}],unlockedSkills:{type:[String],default:["prompt-basics"]}}},{timestamps:!0});n.pre("save",async function(){if(!this.isModified("password"))return;let e=await i.ZP.genSalt(10);this.password=await i.ZP.hash(this.password,e)}),n.methods.comparePassword=async function(e){return i.ZP.compare(e,this.password)},n.statics.findByCredentials=async function(e,t){let r=await this.findOne({email:e}).select("+password");if(!r||!await r.comparePassword(t))throw Error("Invalid credentials");return r};let o=s().models.User||s().model("User",n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,8691,1482],()=>r(15048));module.exports=a})();