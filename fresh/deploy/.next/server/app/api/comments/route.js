"use strict";(()=>{var e={};e.id=2013,e.ids=[2013],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},81280:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>u,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>d});var o=r(49303),s=r(88716),a=r(60670),i=r(87070),l=r(75748),p=r(84283);async function c(e){try{await (0,l.Z)();let{searchParams:t}=new URL(e.url),n=t.get("postId"),o=t.get("status"),s=parseInt(t.get("limit")||"50"),a=parseInt(t.get("page")||"1"),c={};n&&(c.postId=n),o&&(c.status=o);let d=await p.Z.countDocuments(c),m=await p.Z.find(c).sort({createdAt:-1}).skip((a-1)*s).limit(s).lean(),u=(await r.e(7861).then(r.bind(r,7861))).default,g=(await r.e(3959).then(r.bind(r,23959))).default,h=await Promise.all(m.map(async e=>{let t="Unknown Post";if(e.postId&&"string"==typeof e.postId&&e.postId.startsWith("tool-")){let r=e.postId.replace("tool-","");try{let e=await u.findById(r).select("name").lean();e&&(t=`Tool: ${e.name}`)}catch(e){console.error("Error fetching tool:",e)}}else try{let r=await g.findById(e.postId).select("title").lean();r&&(t=`Post: ${r.title}`)}catch(e){console.error("Error fetching post:",e)}return{...e,id:e._id.toString(),postId:e.postId,postTitle:t,author:e.author,_id:void 0}}));return i.NextResponse.json({comments:h,pagination:{page:a,limit:s,total:d,totalPages:Math.ceil(d/s)}})}catch(e){return console.error("Get comments error:",e),console.error("Error details:",JSON.stringify(e,null,2)),i.NextResponse.json({error:"Failed to fetch comments",details:e instanceof Error?e.message:String(e)},{status:500})}}async function d(e){try{await (0,l.Z)();let t=await e.json(),r=new p.Z({...t,status:"pending"});return await r.save(),i.NextResponse.json({success:!0,comment:{...r.toObject(),id:r._id.toString()}})}catch(e){return console.error("Create comment error:",e),console.error("Error details:",JSON.stringify(e,null,2)),i.NextResponse.json({error:"Failed to create comment",details:e instanceof Error?e.message:String(e)},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/comments/route",pathname:"/api/comments",filename:"route",bundlePath:"app/api/comments/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\comments\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:g,serverHooks:h}=m,f="/api/comments/route";function y(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},75748:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),o=r.n(n);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let i=async function(){if(a.conn)return a.conn;a.promise||(a.promise=o().connect(s,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},84283:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),o=r.n(n);let s=new n.Schema({postId:{type:String,required:[!0,"Post ID is required"],index:!0},author:{name:{type:String,required:!0},email:{type:String},avatar:{type:String},userId:{type:n.Schema.Types.ObjectId,ref:"User"}},content:{type:String,required:[!0,"Content is required"],trim:!0,maxlength:[2e3,"Comment must be less than 2000 characters"]},likes:{type:Number,default:0},parentId:{type:n.Schema.Types.ObjectId,ref:"Comment",default:null},status:{type:String,enum:["pending","approved","rejected","spam"],default:"pending"},isSpam:{type:Boolean,default:!1}},{timestamps:!0});s.index({parentId:1});let a=o().models.Comment||o().model("Comment",s)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(81280));module.exports=n})();