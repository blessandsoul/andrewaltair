"use strict";(()=>{var e={};e.id=2541,e.ids=[2541],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89238:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>I,requestAsyncStorage:()=>b,routeModule:()=>x,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var o={};r.r(o),r.d(o,{GET:()=>l,POST:()=>g});var n=r(49303),a=r(88716),s=r(60670),i=r(87070),u=r(75748),m=r(11185),d=r.n(m);let c=new m.Schema({botId:{type:m.Schema.Types.ObjectId,ref:"Bot",required:[!0,"Bot ID is required"],index:!0},userId:{type:m.Schema.Types.ObjectId,ref:"User"},userName:{type:String,required:[!0,"User name is required"],trim:!0},userAvatar:{type:String},text:{type:String,required:[!0,"Comment text is required"],trim:!0,maxlength:[2e3,"Comment must be less than 2000 characters"]},rating:{type:Number,min:1,max:5},likes:{type:Number,default:0},status:{type:String,enum:["pending","approved","rejected"],default:"approved"}},{timestamps:!0});c.index({botId:1,createdAt:-1});let p=d().models.BotComment||d().model("BotComment",c);async function l(e){try{await (0,u.Z)();let{searchParams:t}=new URL(e.url),r=t.get("botId");if(!r)return i.NextResponse.json({error:"Bot ID is required"},{status:400});let o=(await p.find({botId:r,status:"approved"}).sort({createdAt:-1}).lean()).map(e=>({id:e._id.toString(),botId:e.botId.toString(),userId:e.userId?.toString(),userName:e.userName,userAvatar:e.userAvatar,text:e.text,rating:e.rating,likes:e.likes,createdAt:e.createdAt.toISOString()}));return i.NextResponse.json({comments:o,total:o.length})}catch(e){return console.error("Get bot comments error:",e),i.NextResponse.json({error:"Failed to fetch comments"},{status:500})}}async function g(e){try{await (0,u.Z)();let{botId:t,text:r,rating:o}=await e.json();if(!t||!r)return i.NextResponse.json({error:"Bot ID and text are required"},{status:400});let n=new p({botId:t,userName:"სტუმარი",userAvatar:"/images/default-avatar.jpg",text:r,rating:o||5,status:"approved"});return await n.save(),i.NextResponse.json({success:!0,comment:{id:n._id.toString(),botId:n.botId.toString(),userName:n.userName,userAvatar:n.userAvatar,text:n.text,rating:n.rating,likes:n.likes,createdAt:n.createdAt.toISOString()}})}catch(e){return console.error("Create bot comment error:",e),i.NextResponse.json({error:"Failed to create comment"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/bot-comments/route",pathname:"/api/bot-comments",filename:"route",bundlePath:"app/api/bot-comments/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\bot-comments\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:b,staticGenerationAsyncStorage:v,serverHooks:h}=x,f="/api/bot-comments/route";function I(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},75748:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(11185),n=r.n(o);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=s);let i=async function(){if(s.conn)return s.conn;s.promise||(s.promise=n().connect(a,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972],()=>r(89238));module.exports=o})();