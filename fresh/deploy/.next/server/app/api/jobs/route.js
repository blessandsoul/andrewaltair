"use strict";(()=>{var e={};e.id=4204,e.ids=[4204],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22784:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>R,routeModule:()=>j,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var r={};n.r(r),n.d(r,{DELETE:()=>b,GET:()=>m,POST:()=>g,PUT:()=>x});var s=n(49303),o=n(88716),a=n(60670),u=n(87070),i=n(75748),d=n(11185),l=n.n(d);let c=new d.Schema({name:{type:String,required:!0},type:{type:String,enum:["email","backup","cleanup","sync","report","other"],default:"other"},status:{type:String,enum:["pending","running","completed","failed","cancelled"],default:"pending"},schedule:String,lastRun:Date,nextRun:Date,result:{success:Boolean,message:String,data:d.Schema.Types.Mixed},retryCount:{type:Number,default:0},maxRetries:{type:Number,default:3}},{timestamps:!0});c.index({status:1,nextRun:1}),c.index({type:1});let p=l().models.ScheduledJob||l().model("ScheduledJob",c);async function m(e){try{await (0,i.Z)();let{searchParams:t}=new URL(e.url),n=t.get("status"),r=t.get("type"),s=parseInt(t.get("limit")||"50"),o={};n&&(o.status=n),r&&(o.type=r);let a=await p.find(o).sort({updatedAt:-1}).limit(s).lean(),d={total:await p.countDocuments(),pending:await p.countDocuments({status:"pending"}),running:await p.countDocuments({status:"running"}),completed:await p.countDocuments({status:"completed"}),failed:await p.countDocuments({status:"failed"})};return u.NextResponse.json({jobs:a.map(e=>({id:e._id.toString(),name:e.name,type:e.type,status:e.status,schedule:e.schedule,lastRun:e.lastRun,nextRun:e.nextRun,result:e.result,retryCount:e.retryCount,createdAt:e.createdAt,updatedAt:e.updatedAt})),stats:d})}catch(e){return console.error("Get jobs error:",e),u.NextResponse.json({error:"Failed to get jobs"},{status:500})}}async function g(e){try{await (0,i.Z)();let t=await e.json();if(!t.name)return u.NextResponse.json({error:"Job name is required"},{status:400});let n=await p.create({name:t.name,type:t.type||"other",status:"pending",schedule:t.schedule,nextRun:t.nextRun,maxRetries:t.maxRetries||3});return u.NextResponse.json({success:!0,job:{id:n._id.toString(),name:n.name,status:n.status}})}catch(e){return console.error("Create job error:",e),u.NextResponse.json({error:"Failed to create job"},{status:500})}}async function x(e){try{await (0,i.Z)();let{id:t,status:n,result:r}=await e.json();if(!t)return u.NextResponse.json({error:"Job ID is required"},{status:400});let s={};n&&(s.status=n,"running"===n&&(s.lastRun=new Date)),r&&(s.result=r);let o=await p.findByIdAndUpdate(t,s,{new:!0});if(!o)return u.NextResponse.json({error:"Job not found"},{status:404});return u.NextResponse.json({success:!0,job:{id:o._id.toString(),status:o.status}})}catch(e){return console.error("Update job error:",e),u.NextResponse.json({error:"Failed to update job"},{status:500})}}async function b(e){try{await (0,i.Z)();let{searchParams:t}=new URL(e.url),n=t.get("id");if(!n)return u.NextResponse.json({error:"Job ID is required"},{status:400});if(!await p.findByIdAndDelete(n))return u.NextResponse.json({error:"Job not found"},{status:404});return u.NextResponse.json({success:!0,message:"Job deleted"})}catch(e){return console.error("Delete job error:",e),u.NextResponse.json({error:"Failed to delete job"},{status:500})}}let j=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\jobs\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:R,staticGenerationAsyncStorage:f,serverHooks:y}=j,h="/api/jobs/route";function w(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},75748:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(11185),s=n.n(r);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let u=async function(){if(a.conn)return a.conn;a.promise||(a.promise=s().connect(o,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>n(22784));module.exports=r})();