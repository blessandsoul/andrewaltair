"use strict";(()=>{var e={};e.id=115,e.ids=[115],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},36131:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{DELETE:()=>m,GET:()=>l,PATCH:()=>y,PUT:()=>c});var n=r(49303),s=r(88716),i=r(60670),a=r(87070),p=r(75748),d=r(37405),u=r(42549);async function l(e,{params:t}){try{await (0,p.Z)();let{id:e}=await t,r=await d.Z.findById(e).lean();if(!r)return a.NextResponse.json({error:"Prompt not found"},{status:404});return await d.Z.findByIdAndUpdate(e,{$inc:{views:1}}),a.NextResponse.json({...r,id:r._id.toString(),_id:void 0})}catch(e){return console.error("Get prompt error:",e),a.NextResponse.json({error:"Failed to fetch prompt"},{status:500})}}async function c(e,{params:t}){try{await (0,p.Z)();let{id:r}=await t,o=await e.json(),n=e.cookies.get("prompt_session_id")?.value,s=await d.Z.findById(r);if(!s)return a.NextResponse.json({error:"Prompt not found"},{status:404});if(s.sessionId!==n&&!s.isTemplate)return a.NextResponse.json({error:"Not authorized"},{status:403});let{isFavorite:i,isPublic:l,title:c,description:m,category:y,tags:f,qualityScore:g,qualityFeedback:x,translations:v,variations:S,lastTestResponse:h,content:w,formData:N}=o,b={},R={};w&&w!==s.content&&(R.versions={content:s.content,formData:s.formData,createdAt:new Date},b.content=w,N&&(b.formData=N)),"boolean"==typeof i&&(b.isFavorite=i),"boolean"==typeof l&&(b.isPublic=l),void 0!==c&&(b.title=c),void 0!==m&&(b.description=m),void 0!==y&&(b.category=y),void 0!==f&&(b.tags=f),void 0!==g&&(b.qualityScore=g),void 0!==x&&(b.qualityFeedback=x),void 0!==v&&(b.translations=v),void 0!==S&&(b.variations=S),void 0!==h&&(b.lastTestResponse=h,b.lastTestedAt=new Date),l&&!s.shareToken&&(b.shareToken=(0,u.x0)(10));let j={$set:b};Object.keys(R).length>0&&(j.$push=R);let k=await d.Z.findByIdAndUpdate(r,j,{new:!0,lean:!0});return a.NextResponse.json({...k,id:k._id.toString(),_id:void 0})}catch(e){return console.error("Update prompt error:",e),a.NextResponse.json({error:"Failed to update prompt"},{status:500})}}async function m(e,{params:t}){try{await (0,p.Z)();let{id:r}=await t,o=e.cookies.get("prompt_session_id")?.value,n=await d.Z.findById(r);if(!n)return a.NextResponse.json({error:"Prompt not found"},{status:404});if(n.sessionId!==o)return a.NextResponse.json({error:"Not authorized"},{status:403});return await d.Z.findByIdAndDelete(r),a.NextResponse.json({success:!0})}catch(e){return console.error("Delete prompt error:",e),a.NextResponse.json({error:"Failed to delete prompt"},{status:500})}}async function y(e,{params:t}){try{await (0,p.Z)();let{id:r}=await t,{action:o}=await e.json(),n={};switch(o){case"use":n.uses=1;break;case"copy":n.copies=1;break;case"like":n.likes=1;break;default:return a.NextResponse.json({error:"Invalid action"},{status:400})}return await d.Z.findByIdAndUpdate(r,{$inc:n}),a.NextResponse.json({success:!0})}catch(e){return console.error("Patch prompt error:",e),a.NextResponse.json({error:"Failed to update prompt"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/prompts/[id]/route",pathname:"/api/prompts/[id]",filename:"route",bundlePath:"app/api/prompts/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\prompts\\[id]\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:v}=f,S="/api/prompts/[id]/route";function h(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:x})}},75748:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(11185),n=r.n(o);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let a=async function(){if(i.conn)return i.conn;i.promise||(i.promise=n().connect(s,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},37405:(e,t,r)=>{r.d(t,{Z:()=>p});var o=r(11185),n=r.n(o);let s=new o.Schema({role:{type:String,required:!0},customRole:{type:String},tone:{type:String},context:{type:String},customContext:{type:String},task:{type:String,required:!0},outputFormat:{type:String},constraints:{type:String}},{_id:!1}),i=new o.Schema({en:{type:String},ge:{type:String},ru:{type:String}},{_id:!1}),a=new o.Schema({content:{type:String,required:[!0,"Content is required"]},formData:{type:s,required:!0},userId:{type:o.Schema.Types.ObjectId,ref:"User",index:!0},sessionId:{type:String,index:!0},versions:[{content:{type:String,required:!0},formData:{type:s},createdAt:{type:Date,default:Date.now},changeNote:{type:String}}],isFavorite:{type:Boolean,default:!1,index:!0},isTemplate:{type:Boolean,default:!1,index:!0},isPublic:{type:Boolean,default:!1,index:!0},title:{type:String,trim:!0},description:{type:String,trim:!0},category:{type:String,index:!0},tags:{type:[String],default:[]},icon:{type:String},shareToken:{type:String,unique:!0,sparse:!0},qualityScore:{type:Number,min:1,max:10},qualityFeedback:{type:String},tokenCount:{type:Number,default:0},translations:{type:i},variations:{type:[String],default:[]},views:{type:Number,default:0},uses:{type:Number,default:0},copies:{type:Number,default:0},likes:{type:Number,default:0},lastTestResponse:{type:String},lastTestedAt:{type:Date}},{timestamps:!0});a.index({content:"text",title:"text",description:"text"}),a.index({createdAt:-1}),a.index({likes:-1}),a.index({uses:-1});let p=n().models.Prompt||n().model("Prompt",a)},42549:(e,t,r)=>{let o,n;r.d(t,{x0:()=>a});var s=r(6113);let i=e=>{!o||o.length<e?(o=Buffer.allocUnsafe(128*e),s.randomFillSync(o),n=0):n+e>o.length&&(s.randomFillSync(o),n=0),n+=e},a=(e=21)=>{i(e|=0);let t="";for(let r=n-e;r<n;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&o[r]];return t}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972],()=>r(36131));module.exports=o})();