"use strict";(()=>{var e={};e.id=2161,e.ids=[2161],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56121:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>w,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var r={};s.r(r),s.d(r,{DELETE:()=>c,GET:()=>d,PUT:()=>l});var o=s(49303),n=s(88716),a=s(60670),i=s(87070),p=s(75748),u=s(83861);async function d(e,{params:t}){try{await (0,p.Z)();let{id:e}=await t,s=await u.Z.findById(e).populate("promptIds","content formData qualityScore uses likes tokenCount").populate("winnerId","content formData").lean();if(!s)return i.NextResponse.json({error:"Test not found"},{status:404});return i.NextResponse.json({test:s})}catch(e){return console.error("Get test error:",e),i.NextResponse.json({error:"Failed to fetch test"},{status:500})}}async function l(e,{params:t}){try{await (0,p.Z)();let{id:s}=await t,{action:r,promptId:o,rating:n}=await e.json(),a=await u.Z.findById(s);if(!a)return i.NextResponse.json({error:"Test not found"},{status:404});if("record-use"===r){let e=a.results.findIndex(e=>e.promptId.toString()===o);if(-1!==e){if(a.results[e].uses+=1,n){let t=a.results[e].avgRating,s=a.results[e].uses;a.results[e].avgRating=(t*(s-1)+n)/s}await a.save()}}else if("record-conversion"===r){let e=a.results.findIndex(e=>e.promptId.toString()===o);-1!==e&&(a.results[e].conversions+=1,await a.save())}else if("complete"===r){let e=null,t=-1;for(let s of a.results){let r=(s.uses>0?s.conversions/s.uses:0)*s.avgRating;r>t&&(t=r,e=s.promptId)}a.status="completed",a.completedAt=new Date,a.winnerId=e,await a.save()}else"pause"===r?(a.status="paused",await a.save()):"resume"===r&&(a.status="active",await a.save());return i.NextResponse.json({success:!0})}catch(e){return console.error("Update test error:",e),i.NextResponse.json({error:"Failed to update test"},{status:500})}}async function c(e,{params:t}){try{await (0,p.Z)();let{id:e}=await t;return await u.Z.findByIdAndDelete(e),i.NextResponse.json({success:!0})}catch(e){return console.error("Delete test error:",e),i.NextResponse.json({error:"Failed to delete test"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/prompts/tests/[id]/route",pathname:"/api/prompts/tests/[id]",filename:"route",bundlePath:"app/api/prompts/tests/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\prompts\\tests\\[id]\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:y}=m,w="/api/prompts/tests/[id]/route";function g(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},75748:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(11185),o=s.n(r);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let i=async function(){if(a.conn)return a.conn;a.promise||(a.promise=o().connect(n,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},83861:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(11185),o=s.n(r);let n=new r.Schema({promptId:{type:r.Schema.Types.ObjectId,ref:"Prompt",required:!0},uses:{type:Number,default:0},avgRating:{type:Number,default:0},conversions:{type:Number,default:0}},{_id:!1}),a=new r.Schema({name:{type:String,required:!0,trim:!0},description:{type:String,trim:!0},userId:{type:r.Schema.Types.ObjectId,ref:"User",index:!0},promptIds:[{type:r.Schema.Types.ObjectId,ref:"Prompt"}],results:{type:[n],default:[]},status:{type:String,enum:["active","completed","paused"],default:"active",index:!0},startedAt:{type:Date,default:Date.now},completedAt:{type:Date},winnerId:{type:r.Schema.Types.ObjectId,ref:"Prompt"}},{timestamps:!0}),i=o().models.PromptTest||o().model("PromptTest",a)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>s(56121));module.exports=r})();