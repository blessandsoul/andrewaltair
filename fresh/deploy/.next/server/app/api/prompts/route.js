"use strict";(()=>{var e={};e.id=7437,e.ids=[7437],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},50646:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>m});var o=r(49303),s=r(88716),i=r(60670),a=r(87070),p=r(75748),l=r(37405),u=r(42549);function c(e){return e.cookies.get("prompt_session_id")?.value||(0,u.x0)()}async function d(e){try{await (0,p.Z)();let{searchParams:t}=new URL(e.url),r=t.get("type")||"history",n=c(e),o=t.get("category"),s=t.get("search"),i=parseInt(t.get("page")||"1"),u=parseInt(t.get("limit")||"20"),d=t.get("sort")||"createdAt",m={};switch(r){case"history":m={sessionId:n,isTemplate:!1};break;case"favorites":m={sessionId:n,isFavorite:!0};break;case"templates":m={isTemplate:!0};break;case"gallery":m={isPublic:!0,isTemplate:!1}}o&&(m.category=o),s&&(m.$text={$search:s});let g={};g[d]=-1;let y=await l.Z.find(m).sort(g).skip((i-1)*u).limit(u).lean(),x=await l.Z.countDocuments(m),h=y.map(e=>({...e,id:e._id.toString(),_id:void 0})),S=a.NextResponse.json({prompts:h,pagination:{page:i,limit:u,total:x,pages:Math.ceil(x/u)}});return e.cookies.get("prompt_session_id")||S.cookies.set("prompt_session_id",n,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:31536e3}),S}catch(e){return console.error("Get prompts error:",e),a.NextResponse.json({error:"Failed to fetch prompts"},{status:500})}}async function m(e){try{await (0,p.Z)();let t=await e.json(),r=c(e),{content:n,formData:o,title:s,description:i,category:d,tags:m,isTemplate:g,isPublic:y}=t;if(!n||!o?.role||!o?.task)return a.NextResponse.json({error:"Content, role, and task are required"},{status:400});let x=function(e){let t=/[^\x00-\x7F]/.test(e);return Math.ceil(e.length/(t?2:4))}(n),h=(0,u.x0)(10),S=await l.Z.create({content:n,formData:o,sessionId:r,title:s,description:i,category:d,tags:m||[],isTemplate:g||!1,isPublic:y||!1,tokenCount:x,shareToken:h,versions:[{content:n,formData:o,createdAt:new Date,changeNote:"პირველი ვერსია"}]}),f=a.NextResponse.json({id:S._id.toString(),shareToken:S.shareToken,tokenCount:x});return e.cookies.get("prompt_session_id")||f.cookies.set("prompt_session_id",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:31536e3}),f}catch(e){return console.error("Create prompt error:",e),a.NextResponse.json({error:"Failed to create prompt"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/prompts/route",pathname:"/api/prompts",filename:"route",bundlePath:"app/api/prompts/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\prompts\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:h}=g,S="/api/prompts/route";function f(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},75748:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),o=r.n(n);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let a=async function(){if(i.conn)return i.conn;i.promise||(i.promise=o().connect(s,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},37405:(e,t,r)=>{r.d(t,{Z:()=>p});var n=r(11185),o=r.n(n);let s=new n.Schema({role:{type:String,required:!0},customRole:{type:String},tone:{type:String},context:{type:String},customContext:{type:String},task:{type:String,required:!0},outputFormat:{type:String},constraints:{type:String}},{_id:!1}),i=new n.Schema({en:{type:String},ge:{type:String},ru:{type:String}},{_id:!1}),a=new n.Schema({content:{type:String,required:[!0,"Content is required"]},formData:{type:s,required:!0},userId:{type:n.Schema.Types.ObjectId,ref:"User",index:!0},sessionId:{type:String,index:!0},versions:[{content:{type:String,required:!0},formData:{type:s},createdAt:{type:Date,default:Date.now},changeNote:{type:String}}],isFavorite:{type:Boolean,default:!1,index:!0},isTemplate:{type:Boolean,default:!1,index:!0},isPublic:{type:Boolean,default:!1,index:!0},title:{type:String,trim:!0},description:{type:String,trim:!0},category:{type:String,index:!0},tags:{type:[String],default:[]},icon:{type:String},shareToken:{type:String,unique:!0,sparse:!0},qualityScore:{type:Number,min:1,max:10},qualityFeedback:{type:String},tokenCount:{type:Number,default:0},translations:{type:i},variations:{type:[String],default:[]},views:{type:Number,default:0},uses:{type:Number,default:0},copies:{type:Number,default:0},likes:{type:Number,default:0},lastTestResponse:{type:String},lastTestedAt:{type:Date}},{timestamps:!0});a.index({content:"text",title:"text",description:"text"}),a.index({createdAt:-1}),a.index({likes:-1}),a.index({uses:-1});let p=o().models.Prompt||o().model("Prompt",a)},42549:(e,t,r)=>{let n,o;r.d(t,{x0:()=>a});var s=r(6113);let i=e=>{!n||n.length<e?(n=Buffer.allocUnsafe(128*e),s.randomFillSync(n),o=0):o+e>n.length&&(s.randomFillSync(n),o=0),o+=e},a=(e=21)=>{i(e|=0);let t="";for(let r=o-e;r<o;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[r]];return t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(50646));module.exports=n})();