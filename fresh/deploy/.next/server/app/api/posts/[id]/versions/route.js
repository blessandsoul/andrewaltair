"use strict";(()=>{var e={};e.id=7027,e.ids=[7027,3959],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},45029:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>R,requestAsyncStorage:()=>I,routeModule:()=>w,serverHooks:()=>q,staticGenerationAsyncStorage:()=>b});var n={};r.r(n),r.d(n,{GET:()=>h,POST:()=>S,PUT:()=>x});var i=r(49303),o=r(88716),a=r(60670),s=r(87070),d=r(41482),u=r.n(d),p=r(75748),c=r(23959),l=r(11185),g=r.n(l);let y=new l.Schema({postId:{type:l.Schema.Types.ObjectId,ref:"Post",required:!0,index:!0},version:{type:Number,required:!0},title:{type:String,required:!0},content:{type:String,required:!0},excerpt:String,coverImage:String,category:String,tags:[String],author:{id:{type:l.Schema.Types.ObjectId,ref:"User"},name:String},changedBy:{id:{type:l.Schema.Types.ObjectId,ref:"User"},name:String},changeReason:String},{timestamps:{createdAt:!0,updatedAt:!1}});y.index({postId:1,version:-1});let m=g().models.PostVersion||g().model("PostVersion",y),f=process.env.JWT_SECRET||"fallback-secret";async function v(e){let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return null;try{let e=t.substring(7);return u().verify(e,f)}catch{return null}}async function h(e,{params:t}){try{await (0,p.Z)();let{id:e}=await t,r=await m.find({postId:e}).sort({version:-1}).lean();return s.NextResponse.json({versions:r.map(e=>({id:e._id.toString(),version:e.version,title:e.title,excerpt:e.excerpt,changedBy:e.changedBy,changeReason:e.changeReason,createdAt:e.createdAt}))})}catch(e){return console.error("Get versions error:",e),s.NextResponse.json({error:"Failed to get versions"},{status:500})}}async function S(e,{params:t}){try{await (0,p.Z)();let{id:r}=await t,n=await v(e);if(!n)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{changeReason:i}=await e.json(),o=await c.default.findById(r);if(!o)return s.NextResponse.json({error:"Post not found"},{status:404});let a=await m.findOne({postId:r}).sort({version:-1}).select("version").lean(),d=(a?.version||0)+1,u=await m.create({postId:r,version:d,title:o.title,content:o.content,excerpt:o.excerpt,coverImage:o.coverImage,category:o.category,tags:o.tags,author:o.author,changedBy:{id:n.userId,name:"User"},changeReason:i});return s.NextResponse.json({success:!0,version:{id:u._id.toString(),version:u.version}})}catch(e){return console.error("Create version error:",e),s.NextResponse.json({error:"Failed to create version"},{status:500})}}async function x(e,{params:t}){try{await (0,p.Z)();let{id:r}=await t,n=await v(e);if(!n)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{versionId:i}=await e.json(),o=await m.findById(i);if(!o||o.postId.toString()!==r)return s.NextResponse.json({error:"Version not found"},{status:404});let a=await c.default.findById(r);if(a){let e=await m.findOne({postId:r}).sort({version:-1}).select("version").lean();await m.create({postId:r,version:(e?.version||0)+1,title:a.title,content:a.content,excerpt:a.excerpt,coverImage:a.coverImage,category:a.category,tags:a.tags,author:a.author,changedBy:{id:n.userId,name:"User"},changeReason:`Auto-saved before restoring to v${o.version}`})}return await c.default.findByIdAndUpdate(r,{title:o.title,content:o.content,excerpt:o.excerpt,coverImage:o.coverImage,category:o.category,tags:o.tags}),s.NextResponse.json({success:!0,message:`Restored to version ${o.version}`})}catch(e){return console.error("Restore version error:",e),s.NextResponse.json({error:"Failed to restore version"},{status:500})}}let w=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/posts/[id]/versions/route",pathname:"/api/posts/[id]/versions",filename:"route",bundlePath:"app/api/posts/[id]/versions/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\posts\\[id]\\versions\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:I,staticGenerationAsyncStorage:b,serverHooks:q}=w,N="/api/posts/[id]/versions/route";function R(){return(0,a.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:b})}},75748:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(11185),i=r.n(n);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let s=async function(){if(a.conn)return a.conn;a.promise||(a.promise=i().connect(o,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},23959:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n=r(11185),i=r.n(n);let o=new n.Schema({fire:{type:Number,default:0},love:{type:Number,default:0},mindblown:{type:Number,default:0},applause:{type:Number,default:0},insightful:{type:Number,default:0}},{_id:!1}),a=new n.Schema({metaTitle:{type:String,maxlength:60},metaDescription:{type:String,maxlength:160},keywords:{type:String},canonicalUrl:{type:String},focusKeyword:{type:String},seoScore:{type:Number,min:0,max:100},ogImage:{type:String}},{_id:!1}),s=new n.Schema({name:{type:String,required:!0},avatar:{type:String},role:{type:String}},{_id:!1}),d=new n.Schema({icon:{type:String},title:{type:String},content:{type:String,required:!0},type:{type:String,enum:["intro","section","sarcasm","warning","tip","fact","opinion","cta","hashtags","prompt","author-comment"],default:"section"}},{_id:!1}),u=new n.Schema({horizontal:{type:String},vertical:{type:String}},{_id:!1}),p=new n.Schema({src:{type:String,required:!0},alt:{type:String},caption:{type:String}},{_id:!1}),c=new n.Schema({url:{type:String,required:!0},platform:{type:String,enum:["youtube","vimeo"],required:!0},videoId:{type:String},thumbnailUrl:{type:String}},{_id:!1}),l=new n.Schema({slug:{type:String,required:[!0,"Slug is required"],unique:!0,trim:!0},title:{type:String,required:[!0,"Title is required"],trim:!0},excerpt:{type:String,required:[!0,"Excerpt is required"],trim:!0},content:{type:String,default:""},rawContent:{type:String,default:""},coverImage:{type:String},coverImages:{type:u},gallery:{type:[p],default:[]},sections:{type:[d],default:[]},category:{type:String,required:[!0,"Category is required"],index:!0},tags:{type:[String],default:[]},author:{type:s,required:!0},publishedAt:{type:Date,default:Date.now},readingTime:{type:Number,default:5},views:{type:Number,default:0},comments:{type:Number,default:0},shares:{type:Number,default:0},reactions:{type:o,default:()=>({fire:0,love:0,mindblown:0,applause:0,insightful:0})},featured:{type:Boolean,default:!1},trending:{type:Boolean,default:!1},status:{type:String,enum:["draft","published","scheduled","archived"],default:"draft",index:!0},scheduledFor:{type:Date},order:{type:Number,default:0},seo:{type:a,default:()=>({})},videos:{type:[c],default:[]},relatedPosts:{type:[String],default:[]},numericId:{type:String,unique:!0,sparse:!0,index:!0}},{timestamps:!0});l.index({title:"text",excerpt:"text",content:"text",rawContent:"text",numericId:"text"});let g=i().models.Post||i().model("Post",l)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,1482],()=>r(45029));module.exports=n})();