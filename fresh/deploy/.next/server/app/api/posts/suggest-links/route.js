"use strict";(()=>{var e={};e.id=4298,e.ids=[4298,3959],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},80494:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>g,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var n={};r.r(n),r.d(n,{POST:()=>p});var i=r(49303),a=r(88716),s=r(60670),l=r(87070),o=r(14184),u=r(23959);async function p(e){try{await (0,o.Z)();let{title:t,tags:r,category:n,excludeSlug:i}=await e.json();if(!t&&!r?.length&&!n)return l.NextResponse.json({error:"title, tags, or category required"},{status:400});let a={status:"published"};i&&(a.slug={$ne:i});let s=[];if(n&&(s=await u.default.find({...a,category:n}).select("slug title excerpt coverImages tags category").sort({publishedAt:-1}).limit(5).lean()),s.length<5&&r?.length){let e=await u.default.find({...a,tags:{$in:r},slug:{$nin:s.map(e=>e.slug)}}).select("slug title excerpt coverImages tags category").sort({publishedAt:-1}).limit(5-s.length).lean();s=[...s,...e]}if(s.length<3){let e=await u.default.find({...a,slug:{$nin:s.map(e=>e.slug)}}).select("slug title excerpt coverImages tags category").sort({publishedAt:-1}).limit(3-s.length).lean();s=[...s,...e]}let p=s.map(e=>{let i=0;if(e.category===n&&(i+=10),r?.length&&e.tags?.length){let t=e.tags.filter(e=>r.includes(e));i+=2*t.length}if(t&&e.title){let r=t.toLowerCase().split(/\s+/),n=e.title.toLowerCase().split(/\s+/),a=r.filter(e=>n.includes(e));i+=a.length}return{slug:e.slug,title:e.title,excerpt:e.excerpt?.slice(0,100),coverImage:e.coverImages?.horizontal||e.coverImages?.vertical,category:e.category,relevanceScore:i}});return p.sort((e,t)=>t.relevanceScore-e.relevanceScore),l.NextResponse.json({success:!0,relatedPosts:p.slice(0,5)})}catch(e){return console.error("Suggest links error:",e),l.NextResponse.json({error:"Failed to suggest links",relatedPosts:[]},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/posts/suggest-links/route",pathname:"/api/posts/suggest-links",filename:"route",bundlePath:"app/api/posts/suggest-links/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\posts\\suggest-links\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:m}=g,y="/api/posts/suggest-links/route";function f(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},14184:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(11185),i=r.n(n);let a=process.env.MONGODB_URI||"mongodb://localhost:27017/andrewaltair";if(!a)throw Error("Please define the MONGODB_URI environment variable");let s=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=s);let l=async function(){if(s.conn)return s.conn;s.promise||(s.promise=i().connect(a,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},23959:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var n=r(11185),i=r.n(n);let a=new n.Schema({fire:{type:Number,default:0},love:{type:Number,default:0},mindblown:{type:Number,default:0},applause:{type:Number,default:0},insightful:{type:Number,default:0}},{_id:!1}),s=new n.Schema({metaTitle:{type:String,maxlength:60},metaDescription:{type:String,maxlength:160},keywords:{type:String},canonicalUrl:{type:String},focusKeyword:{type:String},seoScore:{type:Number,min:0,max:100},ogImage:{type:String}},{_id:!1}),l=new n.Schema({name:{type:String,required:!0},avatar:{type:String},role:{type:String}},{_id:!1}),o=new n.Schema({icon:{type:String},title:{type:String},content:{type:String,required:!0},type:{type:String,enum:["intro","section","sarcasm","warning","tip","fact","opinion","cta","hashtags","prompt","author-comment"],default:"section"}},{_id:!1}),u=new n.Schema({horizontal:{type:String},vertical:{type:String}},{_id:!1}),p=new n.Schema({src:{type:String,required:!0},alt:{type:String},caption:{type:String}},{_id:!1}),g=new n.Schema({url:{type:String,required:!0},platform:{type:String,enum:["youtube","vimeo"],required:!0},videoId:{type:String},thumbnailUrl:{type:String}},{_id:!1}),d=new n.Schema({slug:{type:String,required:[!0,"Slug is required"],unique:!0,trim:!0},title:{type:String,required:[!0,"Title is required"],trim:!0},excerpt:{type:String,required:[!0,"Excerpt is required"],trim:!0},content:{type:String,default:""},rawContent:{type:String,default:""},coverImage:{type:String},coverImages:{type:u},gallery:{type:[p],default:[]},sections:{type:[o],default:[]},category:{type:String,required:[!0,"Category is required"],index:!0},tags:{type:[String],default:[]},author:{type:l,required:!0},publishedAt:{type:Date,default:Date.now},readingTime:{type:Number,default:5},views:{type:Number,default:0},comments:{type:Number,default:0},shares:{type:Number,default:0},reactions:{type:a,default:()=>({fire:0,love:0,mindblown:0,applause:0,insightful:0})},featured:{type:Boolean,default:!1},trending:{type:Boolean,default:!1},status:{type:String,enum:["draft","published","scheduled","archived"],default:"draft",index:!0},scheduledFor:{type:Date},order:{type:Number,default:0},seo:{type:s,default:()=>({})},videos:{type:[g],default:[]},relatedPosts:{type:[String],default:[]},numericId:{type:String,unique:!0,sparse:!0,index:!0}},{timestamps:!0});d.index({title:"text",excerpt:"text",content:"text",rawContent:"text",numericId:"text"});let c=i().models.Post||i().model("Post",d)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(80494));module.exports=n})();