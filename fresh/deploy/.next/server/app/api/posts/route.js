"use strict";(()=>{var e={};e.id=990,e.ids=[990,3959],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},57288:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>S,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>g});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),u=r(57708),l=r(75748),p=r(23959),d=r(45898);async function c(e){try{await (0,l.Z)();let{searchParams:t}=new URL(e.url);parseInt(t.get("page")||"1");let r=parseInt(t.get("limit")||"10"),n=t.get("status"),a=t.get("category"),i=t.get("search"),o=t.get("featured"),u=t.get("afterSlug"),d=t.get("trending"),c={};if(n&&(c.status=n),a&&(c.category=a),"true"===o&&(c.featured=!0),"true"===d&&(c.trending=!0),i&&(c.$text={$search:i}),u){let e=await p.default.findOne({slug:u});e&&(c.$or=[{order:{$gt:e.order||0}},{order:e.order||0,createdAt:{$lt:e.createdAt}}])}let g=await p.default.countDocuments(c),m=(await p.default.find(c).sort({order:1,createdAt:-1}).limit(r).lean()).map(e=>({...e,id:e._id.toString(),_id:void 0}));return s.NextResponse.json({posts:m,pagination:{page:1,limit:r,total:g,totalPages:Math.ceil(g/r)}})}catch(e){return console.error("Get posts error:",e),s.NextResponse.json({error:"Failed to fetch posts"},{status:500})}}async function g(e){if(!(0,d.ZW)(e))return(0,d.m)("ადმინისტრატორის წვდომა საჭიროა");try{let t;await (0,l.Z)();let r=await e.json();r.slug||(r.slug=r.title.toLowerCase().replace(/[^a-z0-9\u10A0-\u10FF]+/g,"-").replace(/(^-|-$)/g,""));let n=r.slug,a=n,i=1;for(;await p.default.findOne({slug:a})&&(a=`${n}-${Date.now()}-${i}`,!(++i>5)););r.slug=a;let o=0;for(;!t&&o<5;){let e=Math.floor(1e5+9e5*Math.random()).toString();await p.default.findOne({numericId:e})||(t=e),o++}r.numericId&&(t=r.numericId);let d={...r,numericId:t,excerpt:r.excerpt||r.title||"პოსტი",category:r.category||"ai-tips",author:r.author||{name:"Andrew Altair",avatar:"/avatar.jpg",role:"AI ინოვატორი"},status:r.status||"published",readingTime:r.readingTime||5},c=new p.default(d);return await c.save(),(0,u.revalidatePath)("/blog"),(0,u.revalidatePath)("/"),(0,u.revalidatePath)("/sitemap.xml"),s.NextResponse.json({success:!0,post:{...c.toObject(),id:c._id.toString()}})}catch(t){console.error("Create post error:",t);let e=t instanceof Error?t.message:"Unknown error";return s.NextResponse.json({error:"Failed to create post",details:e},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\GITHUB\\andrewaltair\\fresh\\src\\app\\api\\posts\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:S}=m,h="/api/posts/route";function x(){return(0,o.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:y})}},45898:(e,t,r)=>{r.d(t,{Oh:()=>d,ZW:()=>l,m:()=>c,p$:()=>p}),r(71615);var n=r(41482),a=r.n(n);let i=process.env.ADMIN_PASSWORD,o=process.env.ADMIN_SESSION_SECRET;function s(){if(!o)throw Error("ADMIN_SESSION_SECRET environment variable is required");return o}let u=new Map;function l(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return!1;let r=t.substring(7),n=a().verify(r,s());return"admin"===n.role||"god"===n.role}catch{return!1}}function p(e,t){let r=u.get(t),n=Date.now();if(r&&r.count>=5){let e=n-r.lastAttempt;if(e<9e5)return{valid:!1,locked:!0,remainingAttempts:0,lockoutRemaining:Math.ceil((9e5-e)/1e3)};u.delete(t)}if(!i)return console.error("⚠️ ADMIN_PASSWORD not set in environment!"),{valid:!1,locked:!1,remainingAttempts:0};if(e===i)return u.delete(t),{valid:!0,locked:!1,remainingAttempts:5};let a=u.get(t)||{count:0,lastAttempt:n};return a.count++,a.lastAttempt=n,u.set(t,a),{valid:!1,locked:!1,remainingAttempts:5-a.count}}function d(){return a().sign({role:"admin",iat:Date.now()},s(),{expiresIn:"24h"})}function c(e="Unauthorized"){return new Response(JSON.stringify({error:e}),{status:401,headers:{"Content-Type":"application/json"}})}},75748:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(11185),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=o);let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(i,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},23959:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n=r(11185),a=r.n(n);let i=new n.Schema({fire:{type:Number,default:0},love:{type:Number,default:0},mindblown:{type:Number,default:0},applause:{type:Number,default:0},insightful:{type:Number,default:0}},{_id:!1}),o=new n.Schema({metaTitle:{type:String,maxlength:60},metaDescription:{type:String,maxlength:160},keywords:{type:String},canonicalUrl:{type:String},focusKeyword:{type:String},seoScore:{type:Number,min:0,max:100},ogImage:{type:String}},{_id:!1}),s=new n.Schema({name:{type:String,required:!0},avatar:{type:String},role:{type:String}},{_id:!1}),u=new n.Schema({icon:{type:String},title:{type:String},content:{type:String,required:!0},type:{type:String,enum:["intro","section","sarcasm","warning","tip","fact","opinion","cta","hashtags","prompt","author-comment"],default:"section"}},{_id:!1}),l=new n.Schema({horizontal:{type:String},vertical:{type:String}},{_id:!1}),p=new n.Schema({src:{type:String,required:!0},alt:{type:String},caption:{type:String}},{_id:!1}),d=new n.Schema({url:{type:String,required:!0},platform:{type:String,enum:["youtube","vimeo"],required:!0},videoId:{type:String},thumbnailUrl:{type:String}},{_id:!1}),c=new n.Schema({slug:{type:String,required:[!0,"Slug is required"],unique:!0,trim:!0},title:{type:String,required:[!0,"Title is required"],trim:!0},excerpt:{type:String,required:[!0,"Excerpt is required"],trim:!0},content:{type:String,default:""},rawContent:{type:String,default:""},coverImage:{type:String},coverImages:{type:l},gallery:{type:[p],default:[]},sections:{type:[u],default:[]},category:{type:String,required:[!0,"Category is required"],index:!0},tags:{type:[String],default:[]},author:{type:s,required:!0},publishedAt:{type:Date,default:Date.now},readingTime:{type:Number,default:5},views:{type:Number,default:0},comments:{type:Number,default:0},shares:{type:Number,default:0},reactions:{type:i,default:()=>({fire:0,love:0,mindblown:0,applause:0,insightful:0})},featured:{type:Boolean,default:!1},trending:{type:Boolean,default:!1},status:{type:String,enum:["draft","published","scheduled","archived"],default:"draft",index:!0},scheduledFor:{type:Date},order:{type:Number,default:0},seo:{type:o,default:()=>({})},videos:{type:[d],default:[]},relatedPosts:{type:[String],default:[]},numericId:{type:String,unique:!0,sparse:!0,index:!0}},{timestamps:!0});c.index({title:"text",excerpt:"text",content:"text",rawContent:"text",numericId:"text"});let g=a().models.Post||a().model("Post",c)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,1482,7708,1615],()=>r(57288));module.exports=n})();